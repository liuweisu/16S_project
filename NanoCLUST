# NanoCLUST
Changed github code of NanoCLUST: https://github.com/liuweisu/NanoCLUST/tree/patch-1 

- The ~/conda_envs/read_clustering/environment/yml was changed to:

`name: read_clustering
channels:
  - conda-forge
  - bioconda
  - defaults
dependencies:
  - pandas =1.1.1
  - matplotlib-base =3.3.1
  - datashader =0.11.1
  - holoviews =1.13.3
  - bokeh =2.2.0
  - scikit-learn =0.23.2
  - hdbscan =0.8.28 
  - umap-learn >=0.5.0 
  - numba =0.52.0
  - llvmlite =0.35.0`
  
 
- UMAP set size is decreased to 84000 in order to prevent pre-crashing of the workflow, cause of the lack of computational power

- Matplotlib gave an error; did not want to install correctly and made "temporary" files:
in the ~/NanoCLUST/templates/umap_hdbscan.py add the lines:

`import umap
...
import os 
os.environ['MPLCONFIGDIR'] = os.getcwd() + "/configs/"
...
import matplotlib.pyplot as plt`

- ~/NanoCLUST/templates/get_abundance.py was changed to accept empty values during the get_abundace step; some species cannot get identified since they are not in the system:

`#!/usr/bin/env python
import numpy as np
import matplotlib.pyplot as plt
from matplotlib import rc
import pandas as pd
from functools import reduce
import requests
import json
#https://unipept.ugent.be/apidocs/taxonomy

def get_taxname(tax_id, tax_level):
    tags = {"S": "species_name", "G": "genus_name", "F": "family_name", "O":'order_name', "C": "class_name"}
    tax_level_tag = tags[tax_level]
    
    if str(tax_id) == "nan":
        tax_id = 1
    
    path = 'http://api.unipept.ugent.be/api/v1/taxonomy.json?input[]=' + str(int(tax_id)) + '&extra=true&names=true'
    complete_tax = requests.get(path).text

    # Check if the list returned by json.loads() is not empty
    tax_list = json.loads(complete_tax)
    if len(tax_list) > 0:
        name = tax_list[0][tax_level_tag]
    else:
        name = str(int(tax_id))

    return name`
